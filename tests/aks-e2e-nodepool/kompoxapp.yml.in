apiVersion: ops.kompox.dev/v1alpha1
kind: Defaults
metadata:
  name: defaults
spec: {}
---
apiVersion: ops.kompox.dev/v1alpha1
kind: Workspace
metadata:
  name: ${SERVICE_NAME}
  annotations:
    ops.kompox.dev/id: /ws/${SERVICE_NAME}
spec: {}
---
apiVersion: ops.kompox.dev/v1alpha1
kind: Provider
metadata:
  name: aks1
  annotations:
    ops.kompox.dev/id: /ws/${SERVICE_NAME}/prv/aks1
spec:
  driver: aks
  settings:
    AZURE_AUTH_METHOD: azure_cli
    AZURE_SUBSCRIPTION_ID: ${AZURE_SUBSCRIPTION_ID}
    AZURE_LOCATION: ${AZURE_LOCATION}
---
apiVersion: ops.kompox.dev/v1alpha1
kind: Cluster
metadata:
  name: cluster1
  annotations:
    ops.kompox.dev/id: /ws/${SERVICE_NAME}/prv/aks1/cls/cluster1
spec:
  existing: false
  protection:
    provisioning: readOnly
    installation: readOnly
  settings:
    AZURE_AKS_SYSTEM_VM_SIZE: ${AZURE_AKS_SYSTEM_VM_SIZE}
    AZURE_AKS_SYSTEM_VM_DISK_TYPE: ${AZURE_AKS_SYSTEM_VM_DISK_TYPE}
    AZURE_AKS_SYSTEM_VM_DISK_SIZE_GB: ${AZURE_AKS_SYSTEM_VM_DISK_SIZE_GB}
    AZURE_AKS_SYSTEM_VM_PRIORITY: ${AZURE_AKS_SYSTEM_VM_PRIORITY}
    AZURE_AKS_SYSTEM_VM_ZONES: ${AZURE_AKS_SYSTEM_VM_ZONES}
    AZURE_AKS_USER_VM_SIZE: ${AZURE_AKS_USER_VM_SIZE}
    AZURE_AKS_USER_VM_DISK_TYPE: ${AZURE_AKS_USER_VM_DISK_TYPE}
    AZURE_AKS_USER_VM_DISK_SIZE_GB: ${AZURE_AKS_USER_VM_DISK_SIZE_GB}
    AZURE_AKS_USER_VM_PRIORITY: ${AZURE_AKS_USER_VM_PRIORITY}
    AZURE_AKS_USER_VM_ZONES: ${AZURE_AKS_USER_VM_ZONES}
    AZURE_AKS_DNS_ZONE_RESOURCE_IDS: ${AZURE_AKS_DNS_ZONE_RESOURCE_IDS}
    AZURE_AKS_CONTAINER_REGISTRY_RESOURCE_IDS: ${AZURE_AKS_CONTAINER_REGISTRY_RESOURCE_IDS}
---
apiVersion: ops.kompox.dev/v1alpha1
kind: App
metadata:
  name: nodepool
  annotations:
    ops.kompox.dev/id: /ws/${SERVICE_NAME}/prv/aks1/cls/cluster1/app/nodepool
spec:
  compose: |
    services:
      whoami:
        image: traefik/whoami
        ports:
          - 8080:80
  deployment:
    zone: "1"
