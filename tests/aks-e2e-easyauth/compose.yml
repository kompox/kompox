services:
  easyauth:
    image: mcr.microsoft.com/appsvc/middleware:stage6
    ports:
      - 8000:8000
    env_file:
      - compose-easyauth.yml
      - path: compose-easyauth.override.yml
        required: false
    environment:
      - Host.ListenUrl=http://0.0.0.0:8000
      - Host.DestinationHostUrl=http://127.0.0.1:80
      - Host.AutoHealingMiddlewareEnabled=false
      - Host.UseConsoleLogging=true
      - Host.UseFileLogging=true
      - Host.RewriteHostHeader=false
      - WEBSITE_AUTH_FROM_FILE=true
      - WEBSITE_AUTH_FILE_PATH=/app/easyauth-config.json
    volumes:
      - ./data/easyauth:/data
    configs:
      - source: easyauth-config
        target: /app/easyauth-config.json
  whoami:
    image: traefik/whoami
    network_mode: service:easyauth
    environment:
      - TZ=Asia/Tokyo
configs:
  easyauth-config:
    file: easyauth-config.json
